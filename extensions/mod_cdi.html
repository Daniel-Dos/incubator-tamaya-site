<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
	    <meta charset="utf-8"/>
	    <title>Apache Tamaya&amp;#8201;&amp;#8212;&amp;#8201;Extension: Classloader Isolation Support</title>
	    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	    <meta name="description" content=""/>
	    <meta name="author" content=""/>
	    <meta name="keywords" content=""/>
	    <meta name="generator" content="'JBake '+'${version}"/>

	    <!-- Le styles -->
	    <link href="../css/bootstrap.min.css" rel="stylesheet"/>
	    <link href="../css/asciidoctor.css" rel="stylesheet"/>
	    <link href="../css/base.css" rel="stylesheet"/>
	    <link href="../css/prettify.css" rel="stylesheet"/>

	    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
	    <!--[if lt IE 9]>
	      <script src="../js/html5shiv.min.js"></script>
	    <![endif]-->

	    <!-- Fav and touch icons from ASF -->
			<link rel="shortcut icon" href="../favicon.ico"/>
			<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png"/>
		  <link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png"/>
		  <link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png"/>
		  <link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png"/>
		  <link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png"/>
		  <link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png"/>
		  <link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png"/>
		  <link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png"/>
		  <link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png"/>
		  <link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32"/>
		  <link rel="icon" type="image/png" href="../favicons/favicon-194x194.png" sizes="194x194"/>
		  <link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96"/>
		  <link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192"/>
		  <link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16"/>
		  <link rel="manifest" href="../favicons/manifest.json"/>
		  <link rel="shortcut icon" href="../favicons/favicon.ico"/>
		  <meta name="msapplication-TileColor" content="#603cba"/>
		  <meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png"/>
		  <meta name="msapplication-config" content="../favicons/browserconfig.xml"/>
		  <meta name="theme-color" content="#303284"/>
	</head>
	<body onload="prettyPrint()">
	<div id="wrap">
		<div>

	  <!-- Fixed navbar -->
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../">Apache Tamaya (incubating)</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
						<li><a href="../index.html">Home</a></li>
						<li><a href="../quickstart.html">Quickstart</a></li>
						<li><a href="../index.html">Documentation</a></li>
						<li><a href="..//apidocs/index.html">API</a></li>
						<li><a href="../index.html">Development</a></li>
						<li><a href="../index.html">Releases</a></li>
						<li><a href="../about.html">About</a></li>
						<li><a href="../sitemap.xml">Sitemap</a></li>
            <li><a href="../feed.xml">Subscribe</a></li>
<!--
						<li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="#">Action</a></li>
                <li><a href="#">Another action</a></li>
                <li><a href="#">Something else here</a></li>
                <li class="divider"></li>
                <li class="dropdown-header">Nav header</li>
                <li><a href="#">Separated link</a></li>
                <li><a href="#">One more separated link</a></li>
              </ul>
            </li>
-->
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

	</div>
		<div class="container">

			<div class="page-header">
				<h1>Apache Tamaya&amp;#8201;&amp;#8212;&amp;#8201;Extension: Classloader Isolation Support</h1>
			</div>

			<p><em>2016-11-02</em></p>

			<p><div id="preamble">
<div class="sectionbody">
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="Remote">Tamaya CDI Integration (Extension Modules)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview">Overview</h3>
<div class="paragraph">
<p>Apache Tamaya currently provides two implementations for integration with CDI extensions implementing similar
functionality as described in this document:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Loading of CDI managed SPI components as configuration extensions such as PropertySources, PropertySourceProviders,
PropertyFilters, etc. This also includes SPI defined by any Tamaya submodules.</p>
</li>
<li>
<p>Implement and enable Tamaya&#8217;s configuration injection services with CDI.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hereby there are two implementations provided:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>tamaya-cdi-ee implements injection by using CDI&#8217;s injection mechanism to inject configuration values into the
beans managed by the CDI systems.</p>
</li>
<li>
<p>tamaya-cdi-se implements injection by integrating the tamaya-injection SE based injection module (also used
for Spring and OSGI injection) with CDI. Injection hereby is performed by the Tamaya SE module, whereas
beans and injection control overall are still managed by CDI.</p>
</li>
<li>
<p>One difference, of course, is that tamaya-se also provides an SE compatible API (ConfigurationInjection,
ConfigurationInjector), which is not available, when using the purely Java EE based variant.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The annotations used for all injection functionality in Tamaya is defined as a separate module. This allows you to
code against the injection API without dependency on the concrete injection implementation. As a consequence your
components will be compatible regardless if deployed in a pure SE, a Java EE (CDI) or OSGI or Spring environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dependency&gt;
  &lt;groupId&gt;org.apache.tamaya.ext&lt;/groupId&gt;
  &lt;artifactId&gt;tamaya-injection-api&lt;/artifactId&gt;
  &lt;version&gt;{tamaya-version}&lt;/version&gt;
&lt;/dependency&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compatibility">Compatibility</h3>
<div class="paragraph">
<p>Both modules are based on Java 7, so they will only run on Java 7 and beyond.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installation">Installation</h3>
<div class="paragraph">
<p>To benefit from Tamaya CDI integration you only must one of the following dependencies to your module. Ensure that
you never have installed both CDI extensions at the same time because this may be lead to unforseen side-effects.</p>
</div>
<div class="listingblock">
<div class="title">CDI Pure Application Configuration</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.tamaya.ext&lt;/groupId&gt;
  &lt;artifactId&gt;tamaya-cdi-ee&lt;/artifactId&gt;
  &lt;version&gt;{tamaya-version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">CDI enhanced with Tamaya SE Application Configuration</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.tamaya.ext&lt;/groupId&gt;
  &lt;artifactId&gt;tamaya-cdi-se&lt;/artifactId&gt;
  &lt;version&gt;{tamaya-version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both components will auto-register its components and override the default ServicceContext in use. Additionally they
register CDI extensions that implement Configuration injection as described before.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Never install Tamaya&#8217;s tamaya-cdi-se and tamaya-cdi-ee on the same system, since unpredictable side
           effects could occur.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_registering_cdi_managed_components_into_the_application_s_configurationcontext">Registering CDI managed components into the Application&#8217;s ConfigurationContext</h3>
<div class="paragraph">
<p>As mentioned both modules allow to provide Tamaya SPI extensions modules as ordinary CDI managed beans. By default
extensions should be registered using @Singleton or @ApplicationScoped scope annotations. So you can define/deploy
additional application specific PropertySources and other artifacts simply by defining a CDI managed bean implementing
the required SPI interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Singleton
public class TestPropertySource implements PropertySource{

    final Map&lt;String,String&gt; config = new HashMap&lt;&gt;();

    public TestPropertySource(){
        config.put("a.b.c.key1", "keys current a.b.c.key1");
        config.put("a.b.c.key2", "keys current a.b.c.key2");
        config.put("{"+getName()+"}source", getClass().getName());
    }

    @Override
    public int getOrdinal() {
        return 10;
    }

    @Override
    public String getName() {
        return getClass().getName();
    }

    @Override
    public String get(String key) {
        return config.get(key);
    }

    @Override
    public Map&lt;String, String&gt; getProperties() {
        return config;
    }

    @Override
    public boolean isScannable() {
        return true;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that for many SPI&#8217;s there is a priority mechanism using @Priority annotations in place.
The ServiceContext implementation combines the components registered with the ones loaded from the ServiceLoader
mechanism hereby considering classloaser hierarchies.</p>
</div>
</div>
<div class="sect2">
<h3 id="_annotating_your_classes">Annotating your Classes</h3>
<div class="paragraph">
<p>Basically annotating your classes is stright forward. @Config defines an additional CDI qualifier that is, depending
on the module deployed, handled by a CDI producer (tamaya-cdi-ee) or the Tamaya SE injection mechanism $
(tamaya-cdi-se). All types injected by this module are injected using <em>dependent scope</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@RequestScoped
public class ConfiguredClass{

    @Config
    private String testProperty;

    @Config({"a.b.c.key1","a.b.c.key2","a.b.c.key3"})
    @ConfigDefault("The current \\${JAVA_HOME} env property is ${env:JAVA_HOME}.")
    String value1;

    @Config({"foo","a.b.c.key2"})
    private String value2;

    @Config
    @ConfigDefault("N/A")
    private String runtimeVersion;

    @Config
    @ConfigDefault("${sys:java.version}")
    private String javaVersion2;

    @Config
    @ConfigDefault("5")
    private Integer int1;

    ...

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_advanced_use_cases">Advanced Use Cases</h3>
<div class="paragraph">
<p>Beside basic configuration Tamaya also covers additional requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>_Reading multiple keys, where the first successful one is determining the value of the configuration, is
simply possible, by adding multiple keys to the @Configy annotation.
E.g. for trying first a.b and then new.b you would configure it as follows:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Config({"a.b", "new.b"}
private String value;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>When you must apply a ConfigOperator to your config, before reading the configuration, you can
configure one as follows:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Config({"a.b", "new.b"}
@WithConfigOperator(MyOperator.class)
private String value;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>When you must apply a some special conversion, or you use a type that is not registered
for conversion, you can configure a custom converter to be applied as follows:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Config({"a.b", "new.b"}
@WithPropertyConverter(MyConverter.class)
private MySpecialFooType value;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Often multiple keys in a class belong to the same root section. So instead of copying this to
every entry you can define the most common root sections in the type&#8217;s header:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@ConfigDefaultSections({"aaaa", "new"});
public class MyType{

@Config({"b", "[legacy.bKey]"} // lookups: "aaaa.b", "new.b", legacy.bKey
private String value;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above legacy.bKey defines an absolute key, which is not combined with any defined
default section parts.</p>
</div>
</div>
</div>
</div></p>

			<hr />
		</div>
	</div>
	<div>
			<div id="push"></div>

		    <div id="footer">
		      <div class="container">
		        <p class="muted credit">&copy; 2014-2016 Apache Software Foundation | Mixed with <a href="http://getbootstrap.com/">Bootstrap v3.1.1</a>
							| Baked with <a href="http://jbake.org">JBake <span>v2.5.0</span></a>
							at <span>2016-11-02</span>
						</p>
						<p>
								<b>Disclaimer</b>
                    Apache Tamaya (incubating) is an effort undergoing
                    incubation at
                    The Apache Software Foundation (ASF), sponsored by
                    the name of Apache Incubator. Incubation is required of
                    all newly accepted projects until a further review indicates
                    that the infrastructure, communications, and decision making
                    process have stabilized in a manner consistent with other
                    successful ASF projects. While incubation status is not
                    necessarily a reflection of the completeness or stability of
                    the code, it does indicate that the project has yet to
                    be fully endorsed by the ASF.<br />
                    <a href="http://incubator.apache.org/guides/website.html" style="border:0px;" target="_target"><img class="incubator-logo" src="../logos/egg-logo2.png"/></a>
							</p>
		      </div>
		    </div>

		    <!-- Le javascript
		    ================================================== -->
		    <!-- Placed at the end of the document so the pages load faster -->
		    <script src="../js/jquery-1.11.1.min.js"></script>
		    <script src="../js/bootstrap.min.js"></script>
		    <script src="../js/prettify.js"></script>

    	</div>
    </body>
</html>
