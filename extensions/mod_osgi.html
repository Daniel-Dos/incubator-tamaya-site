<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
	    <meta charset="utf-8"/>
	    <title>Apache Tamaya&amp;#8201;&amp;#8212;&amp;#8201;Extensions: OSGI Integrations</title>
	    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	    <meta name="description" content=""/>
	    <meta name="author" content=""/>
	    <meta name="keywords" content=""/>
	    <meta name="generator" content="'JBake '+'${version}"/>

	    <!-- Le styles -->
	    <link href="../css/bootstrap.min.css" rel="stylesheet"/>
	    <link href="../css/asciidoctor.css" rel="stylesheet"/>
	    <link href="../css/base.css" rel="stylesheet"/>
	    <link href="../css/prettify.css" rel="stylesheet"/>

	    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
	    <!--[if lt IE 9]>
	      <script src="../js/html5shiv.min.js"></script>
	    <![endif]-->

	    <!-- Fav and touch icons from ASF -->
			<link rel="shortcut icon" href="../favicon.ico"/>
			<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png"/>
		  <link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png"/>
		  <link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png"/>
		  <link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png"/>
		  <link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png"/>
		  <link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png"/>
		  <link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png"/>
		  <link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png"/>
		  <link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png"/>
		  <link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32"/>
		  <link rel="icon" type="image/png" href="../favicons/favicon-194x194.png" sizes="194x194"/>
		  <link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96"/>
		  <link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192"/>
		  <link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16"/>
		  <link rel="manifest" href="../favicons/manifest.json"/>
		  <link rel="shortcut icon" href="../favicons/favicon.ico"/>
		  <meta name="msapplication-TileColor" content="#603cba"/>
		  <meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png"/>
		  <meta name="msapplication-config" content="../favicons/browserconfig.xml"/>
		  <meta name="theme-color" content="#303284"/>
	</head>
	<body onload="prettyPrint()">
	<div id="wrap">
		<div>

	  <!-- Fixed navbar -->
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../">Apache Tamaya (incubating)</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
						<li><a href="../index.html">Home</a></li>
						<li><a href="../quickstart.html">Quickstart</a></li>
						<li><a href="../index.html">Documentation</a></li>
						<li><a href="..//apidocs/index.html">API</a></li>
						<li><a href="../index.html">Development</a></li>
						<li><a href="../index.html">Releases</a></li>
						<li><a href="../about.html">About</a></li>
						<li><a href="../sitemap.xml">Sitemap</a></li>
            <li><a href="../feed.xml">Subscribe</a></li>
<!--
						<li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="#">Action</a></li>
                <li><a href="#">Another action</a></li>
                <li><a href="#">Something else here</a></li>
                <li class="divider"></li>
                <li class="dropdown-header">Nav header</li>
                <li><a href="#">Separated link</a></li>
                <li><a href="#">One more separated link</a></li>
              </ul>
            </li>
-->
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

	</div>
		<div class="container">

			<div class="page-header">
				<h1>Apache Tamaya&amp;#8201;&amp;#8212;&amp;#8201;Extensions: OSGI Integrations</h1>
			</div>

			<p><em>2016-10-31</em></p>

			<p><div id="preamble">
<div class="sectionbody">
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="Optional">Tamaya OSGI Support</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview">Overview</h3>
<div class="paragraph">
<p>Tamaya provides also support for integration with OSGI. Hereby several options are available how Tamaya can be used in
an OSGI context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>All Tamaya modules, its API and core library are actually valid OSGI bundles. So adding them into your OSGI modules
and using Tamaya is basically directly supported. Nevertheless OSGI works rather differently from a class- and
resource loading perspective. As long as you rely on Tamaya&#8217;s mechanisms for resource loading things should work
out of the box. In the back Tamaya&#8217;s core module actually comes with implicit OSGI support, which is automatically
activated, if Tamaya is running in an OSGI context. This support actually</p>
<div class="ulist">
<ul>
<li>
<p>Listens on deployed bundles and actively reads all resources configured as java.util.ServiceLoader services and
registers them as OSGI services. Hereby integration is complete meaning you can also register Tamaya services
as normal OSGI services, e.g. your own PropertySource instances.</p>
</li>
<li>
<p>Uses the OSGI bundle to resolve for resources, because accessing them from the classloader directly
typically fails in an OSGI context.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Adding Tamaya&#8217;s OSGI integration module replaces the existing OSGI ConfigAdmin service with an istance based on
Tamaya. Hereby several aspects can be configured using system properties:</p>
<div class="ulist">
<ul>
<li>
<p>org.tamaya.integration.osgi.cm.ranking (int) allows to configure the OSGI service ranking used by the Tamaya
BundleActivator to register Tamaya&#8217;s ConfigAdmin service. In OSGI higher ranking precede lower rankings. By default
Tamaya&#8217;s OSGI extending service registration mechanism is reusing any annotated @Priority priority values as
corresponsing rankings.</p>
</li>
<li>
<p>org.tamaya.integration.osgi.cm.override (boolean) allows to configure if Tamaya is overriding any existing
values from the default ConfigAdmin instance, or only extending them. In other words this setting allows you to
define, which configuration subsystem has precedence for evaluating the final values, either Tamaya based
configuration (default) or the configuration mechanisms provided by default from your OSGI container (when this flag
is set to false).</p>
</li>
<li>
<p>org.tamaya.integration.osgi.cm.inject allows you to deactivate injection of configuration values into your
OSGI services (by default injection is enabled). In all cases accessing the OSGI ConfigAdmin service to
read your configuration is working as usual. But Tamaya adds additional injection functionality, which allows
to inject typed configuration as described by the Tamaya injection api.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>It is also possible to combine things, e.g. when you only define a low ranking for Tamaya&#8217;s configuration service and
the same time allow injection to be active, you will have Tamaya&#8217;s injection support based on your default
OSGI configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_compatibility">Compatibility</h3>
<div class="paragraph">
<p>All module described are based on Java 7, so it will run on Java 7 and beyond.
The modules are built against OSGI Compendium version 5.0.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installation">Installation</h3>
<div class="paragraph">
<p>To benefit from Tamaya in an OSGI context you must deploy at least the following modules to your OSGI runtime
environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-listing" data-lang="listing"># API and core
org.apache.tamaya:tamaya-api:{tamayaVersion}
org.apache.tamaya:tamaya-core:{tamayaVersion}
org.apache.geronimo.specs:geronimo-annotation_1.2_spec:1.0-alpha-1
# injection API. SE injection module and dependencies
org.apache.tamaya.ext:tamaya-injection-api:{tamayaVersion}
org.apache.tamaya.ext:tamaya-injection:{tamayaVersion}
org.apache.geronimo.specs:geronimo-atinject_1.0_spec:1.0
org.apache.geronimo.specs:geronimo-el_2.2_spec:1.0.4
org.apache.geronimo.specs:geronimo-interceptor_1.1_spec:1.0
org.apache.geronimo.specs:geronimo-jcdi_1.1_spec:1.0
# OSGI integration and dependencies
org.apache.tamaya.ext:tamaya-osgi:{tamayaVersion}
org.apache.tamaya.ext:tamaya-functions:{tamayaVersion}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_usage">Usage</h3>
<div class="paragraph">
<p>As an example, what is possible you can implement an OSGI service as a normal POJO and publish it as an OSGI service.
Given that configuration can be injected very easily:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public class HelloServiceImpl implements HelloService{

    @Config("example.message")
    @ConfigDefault("A Tamaya default.")
    private String message;

    @Override
    public String sayHello() {
        System.err.println("HELLO: " + message);
        return message;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_spi">SPI</h3>
<div class="paragraph">
<p>By defauklt the OSGI pid or factory pid is mapped to a corresponding root section in Tamaya&#8217;s configuration. We are
well aware that this might not always be the desired approach. Therefore there as an SPI service provided that allows
to determine this mapping:</p>
</div>
<div class="listingblock">
<div class="title">OSGIConfigRootMapper</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public interface OSGIConfigRootMapper {

    String getTamayaConfigRoot(String pid, String factoryPid);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Registering your own implementation as an OSGI service allows you to redefine the key mapping.
By default a configuration mapping for pid/factoryPid==myBundle is mapped to [bundle:myBundle].
This mapping is used as a prefix when collecting the corresponding entries for the OSGI configuration.</p>
</div>
</div>
</div>
</div></p>

			<hr />
		</div>
	</div>
	<div>
			<div id="push"></div>

		    <div id="footer">
		      <div class="container">
		        <p class="muted credit">&copy; 2014-2016 Apache Software Foundation | Mixed with <a href="http://getbootstrap.com/">Bootstrap v3.1.1</a>
							| Baked with <a href="http://jbake.org">JBake <span>v2.5.0</span></a>
							at <span>2016-10-31</span>
						</p>
						<p>
								<b>Disclaimer</b>
                    Apache Tamaya (incubating) is an effort undergoing
                    incubation at
                    The Apache Software Foundation (ASF), sponsored by
                    the name of Apache Incubator. Incubation is required of
                    all newly accepted projects until a further review indicates
                    that the infrastructure, communications, and decision making
                    process have stabilized in a manner consistent with other
                    successful ASF projects. While incubation status is not
                    necessarily a reflection of the completeness or stability of
                    the code, it does indicate that the project has yet to
                    be fully endorsed by the ASF.<br />
                    <a href="http://incubator.apache.org/guides/website.html" style="border:0px;" target="_target"><img class="incubator-logo" src="../logos/egg-logo2.png"/></a>
							</p>
		      </div>
		    </div>

		    <!-- Le javascript
		    ================================================== -->
		    <!-- Placed at the end of the document so the pages load faster -->
		    <script src="../js/jquery-1.11.1.min.js"></script>
		    <script src="../js/bootstrap.min.js"></script>
		    <script src="../js/prettify.js"></script>

    	</div>
    </body>
</html>
